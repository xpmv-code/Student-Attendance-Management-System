# è¯¾ç¨‹å‘¨æ¬¡åŠŸèƒ½ - å¿«é€Ÿå¼€å§‹

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹ï¼ˆ3åˆ†é’Ÿï¼‰

### æ­¥éª¤1ï¼šæ•°æ®åº“è¿ç§»

æ‰§è¡ŒSQLè¿ç§»è„šæœ¬ï¼Œä¸º `course` è¡¨æ·»åŠ  `week_range` å­—æ®µï¼š

```bash
# æ–¹å¼1ï¼šä½¿ç”¨psqlå‘½ä»¤
psql -U your_username -d your_database -f migrations/add_week_range_to_course.sql

# æ–¹å¼2ï¼šåœ¨PostgreSQLå®¢æˆ·ç«¯ä¸­æ‰§è¡Œ
ALTER TABLE course ADD COLUMN IF NOT EXISTS week_range VARCHAR(50);
```

### æ­¥éª¤2ï¼šé‡æ–°å¯¼å…¥è¯¾ç¨‹

1. **è®¿é—®è¯¾ç¨‹ç®¡ç†é¡µé¢**ï¼š
   ```
   http://127.0.0.1:5000/course/
   ```

2. **ç‚¹å‡»"å¯¼å…¥ICSæ–‡ä»¶"**

3. **ä¸Šä¼ åŒ…å«å‘¨æ¬¡ä¿¡æ¯çš„ICSæ–‡ä»¶**ï¼ˆå¦‚ï¼š`230108.ics`ï¼‰

4. **ç³»ç»Ÿä¼šè‡ªåŠ¨**ï¼š
   - è§£ææ¯ä¸ªè¯¾ç¨‹çš„æ‰€æœ‰ä¸Šè¯¾å‘¨æ¬¡
   - ç”Ÿæˆ `week_range` å­—ç¬¦ä¸²ï¼ˆå¦‚ï¼š`1-8` æˆ– `9-16`ï¼‰
   - ä¿å­˜åˆ°æ•°æ®åº“

### æ­¥éª¤3ï¼šæµ‹è¯•åŠŸèƒ½

#### æµ‹è¯•1ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬

```bash
python test_week_functionality.py
```

åº”è¯¥çœ‹åˆ°æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…

#### æµ‹è¯•2ï¼šè®¿é—®è€ƒå‹¤æ—¥å†

```
http://127.0.0.1:5000/attendance/
```

**éªŒè¯ï¼š**
- å¦‚æœä»Šå¤©æ˜¯ç¬¬1å‘¨å‘¨ä¸€ï¼Œåº”è¯¥æ˜¾ç¤º `week_range` åŒ…å«"1"çš„å‘¨ä¸€è¯¾ç¨‹
- å¦‚æœä»Šå¤©æ˜¯ç¬¬9å‘¨å‘¨ä¸€ï¼Œåº”è¯¥æ˜¾ç¤º `week_range` åŒ…å«"9"çš„å‘¨ä¸€è¯¾ç¨‹

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### å­¦æœŸé…ç½®

**ç¬¬ä¸€å‘¨å¼€å§‹æ—¥æœŸ**ï¼š`2025å¹´9æœˆ1æ—¥`

è¿™ä¸ªæ—¥æœŸåœ¨ `app/utils/week_helper.py` ä¸­é…ç½®ï¼š
```python
FIRST_WEEK_START = date(2025, 9, 1)
```

### å‘¨æ¬¡èŒƒå›´æ ¼å¼

| æ ¼å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `1-8` | è¿ç»­èŒƒå›´ | ç¬¬1å‘¨åˆ°ç¬¬8å‘¨ |
| `9-16` | è¿ç»­èŒƒå›´ | ç¬¬9å‘¨åˆ°ç¬¬16å‘¨ |
| `1-8,13,15,17` | ç»„åˆ | ç¬¬1-8å‘¨ï¼Œç¬¬13ã€15ã€17å‘¨ |
| `1,3,5,7,9` | ä¸è¿ç»­ | åªåœ¨ç¬¬1ã€3ã€5ã€7ã€9å‘¨ |
| ç©ºæˆ–NULL | å…¨å­¦æœŸ | æ¯å‘¨éƒ½ä¸Šè¯¾ |

### æ™ºèƒ½è¿‡æ»¤

**è€ƒå‹¤æ—¥å†è‡ªåŠ¨è¿‡æ»¤é€»è¾‘ï¼š**

```
1. ç”¨æˆ·è®¿é—®æŸä¸ªæ—¥æœŸï¼ˆå¦‚ï¼š2025-09-08ï¼‰
2. ç³»ç»Ÿè®¡ç®—æ˜¯ç¬¬å‡ å‘¨ï¼ˆç¬¬2å‘¨ï¼‰
3. ç³»ç»ŸæŸ¥è¯¢è¯¥æ˜ŸæœŸå‡ çš„è¯¾ç¨‹ï¼ˆå¦‚ï¼šå‘¨ä¸€çš„è¯¾ï¼‰
4. ç³»ç»Ÿè¿‡æ»¤ï¼šåªæ˜¾ç¤º week_range åŒ…å«"2"çš„è¯¾ç¨‹
5. æ˜¾ç¤ºç»“æœ
```

**ç¤ºä¾‹ï¼š**

å‡è®¾æ•°æ®åº“ä¸­æœ‰ï¼š
```
é«˜ç­‰æ•°å­¦    å‘¨ä¸€ 08:00-09:40    week_range: 1-16
å¤§å­¦è‹±è¯­    å‘¨ä¸€ 10:00-11:40    week_range: 1-8
ä¸“ä¸šé€‰ä¿®    å‘¨ä¸€ 14:00-15:40    week_range: 9-16
```

è®¿é—®ä¸åŒå‘¨æ¬¡çš„ç»“æœï¼š
- **ç¬¬2å‘¨å‘¨ä¸€**ï¼šæ˜¾ç¤º é«˜ç­‰æ•°å­¦ã€å¤§å­¦è‹±è¯­ï¼ˆéƒ½åŒ…å«"2"ï¼‰
- **ç¬¬9å‘¨å‘¨ä¸€**ï¼šæ˜¾ç¤º é«˜ç­‰æ•°å­¦ã€ä¸“ä¸šé€‰ä¿®ï¼ˆéƒ½åŒ…å«"9"ï¼‰

## ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šè¯¾ç¨‹åˆ†ä¸¤ä¸ªé˜¶æ®µ

**éœ€æ±‚**ï¼šè¯¾ç¨‹å‰8å‘¨ä¸Šç†è®ºè¯¾ï¼Œå8å‘¨ä¸Šå®éªŒè¯¾

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ›å»ºä¸¤é—¨è¯¾ç¨‹ï¼š
```python
# ç†è®ºè¯¾
course1 = Course(
    course_id='CS101-1',
    course_name='æ•°æ®ç»“æ„ï¼ˆç†è®ºï¼‰',
    teacher_name='å¼ è€å¸ˆ',
    course_time='å‘¨ä¸€ 08:00-09:40',
    course_place='æ•™å­¦æ¥¼A201',
    week_range='1-8'
)

# å®éªŒè¯¾
course2 = Course(
    course_id='CS101-2',
    course_name='æ•°æ®ç»“æ„ï¼ˆå®éªŒï¼‰',
    teacher_name='æè€å¸ˆ',
    course_time='å‘¨ä¸€ 08:00-09:40',
    course_place='å®éªŒæ¥¼B302',
    week_range='9-16'
)
```

### åœºæ™¯2ï¼šéš”å‘¨ä¸Šè¯¾

**éœ€æ±‚**ï¼šè¯¾ç¨‹åªåœ¨å•å‘¨ï¼ˆæˆ–åŒå‘¨ï¼‰ä¸Šè¯¾

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# å•å‘¨ä¸Šè¯¾
course = Course(
    course_id='CS102',
    course_name='ä¸“é¢˜è®²åº§',
    week_range='1,3,5,7,9,11,13,15'
)

# åŒå‘¨ä¸Šè¯¾
course = Course(
    course_id='CS103',
    course_name='å®è·µè¯¾ç¨‹',
    week_range='2,4,6,8,10,12,14,16'
)
```

### åœºæ™¯3ï¼šç‰¹å®šå‘¨æ¬¡çš„è¯¾ç¨‹

**éœ€æ±‚**ï¼šè¯¾ç¨‹åªåœ¨ç‰¹å®šçš„å‡ å‘¨ä¸Šè¯¾

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
course = Course(
    course_id='CS104',
    course_name='æœŸä¸­å¤ä¹ ',
    week_range='7,8,9'  # åªåœ¨ç¬¬7ã€8ã€9å‘¨ä¸Šè¯¾
)
```

## âš™ï¸ é…ç½®ä¿®æ”¹

### ä¿®æ”¹å­¦æœŸå¼€å§‹æ—¥æœŸ

ç¼–è¾‘ `app/utils/week_helper.py`ï¼š
```python
# å°†ç¬¬ä¸€å‘¨å¼€å§‹æ—¥æœŸæ”¹ä¸ºä½ çš„å®é™…å¼€å­¦æ—¥æœŸ
FIRST_WEEK_START = date(2025, 9, 1)  # ä¿®æ”¹è¿™é‡Œ
```

### ä¿®æ”¹æœ€å¤§å‘¨æ¬¡æ•°

ç¼–è¾‘ `app/utils/week_helper.py` ä¸­çš„ `get_week_number` å‡½æ•°ï¼š
```python
def get_week_number(target_date):
    # ...
    
    # ä¸€èˆ¬å­¦æœŸæœ€å¤š20å‘¨ï¼Œå¦‚éœ€ä¿®æ”¹ï¼š
    if week_number > 25:  # æ”¹ä¸º25å‘¨
        return None
    
    return week_number
```

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šè¯¾ç¨‹ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› ï¼š**
1. `week_range` å­—æ®µä¸ºç©º â†’ è¯¾ç¨‹ä¼šæ˜¾ç¤º
2. `week_range` ä¸åŒ…å«å½“å‰å‘¨æ¬¡ â†’ è¯¾ç¨‹ä¸æ˜¾ç¤ºï¼ˆæ­£å¸¸ï¼‰
3. å­¦æœŸå¼€å§‹æ—¥æœŸé…ç½®é”™è¯¯ â†’ å‘¨æ¬¡è®¡ç®—é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**
```python
# æ£€æŸ¥è¯¾ç¨‹æ•°æ®
from app.models import Course
from app.utils.week_helper import get_week_number
from datetime import date

course = Course.query.first()
print(f"è¯¾ç¨‹: {course.course_name}")
print(f"å‘¨æ¬¡èŒƒå›´: {course.week_range}")

today_week = get_week_number(date.today())
print(f"ä»Šå¤©æ˜¯ç¬¬{today_week}å‘¨")
print(f"ä»Šå¤©æ˜¯å¦ä¸Šè¯¾: {course.is_teaching_week(today_week)}")
```

### é—®é¢˜2ï¼šæ‰€æœ‰è¯¾ç¨‹éƒ½ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› ï¼š**
å½“å‰æ—¥æœŸä¸åœ¨å­¦æœŸèŒƒå›´å†…ï¼ˆç¬¬1-20å‘¨ï¼‰

**è§£å†³æ–¹æ³•ï¼š**
```python
from app.utils.week_helper import get_week_number, FIRST_WEEK_START
from datetime import date

today = date.today()
week = get_week_number(today)
print(f"å­¦æœŸå¼€å§‹æ—¥æœŸ: {FIRST_WEEK_START}")
print(f"ä»Šå¤©: {today}")
print(f"ä»Šå¤©æ˜¯ç¬¬{week}å‘¨")

if week is None:
    print("âš ï¸ å½“å‰æ—¥æœŸä¸åœ¨å­¦æœŸèŒƒå›´å†…")
```

### é—®é¢˜3ï¼šå¯¼å…¥ICSåweek_rangeä¸ºç©º

**å¯èƒ½åŸå› ï¼š**
ICSæ–‡ä»¶ä¸­æ²¡æœ‰"å‘¨æ¬¡: X"ä¿¡æ¯

**è§£å†³æ–¹æ³•ï¼š**
æ‰‹åŠ¨è®¾ç½® `week_range`ï¼š
```python
from app.models import Course
from app import db

# å°†æ‰€æœ‰è¯¾ç¨‹è®¾ç½®ä¸ºå…¨å­¦æœŸ
courses = Course.query.filter(Course.week_range == None).all()
for course in courses:
    course.week_range = '1-16'
db.session.commit()
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **è¯¦ç»†è¯´æ˜**ï¼š`è¯¾ç¨‹å‘¨æ¬¡åŠŸèƒ½è¯´æ˜.md`
- **æµ‹è¯•è„šæœ¬**ï¼š`test_week_functionality.py`
- **æ•°æ®åº“è¿ç§»**ï¼š`migrations/add_week_range_to_course.sql`

## âœ… æ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸ï¼š

- [ ] æ•°æ®åº“å·²æ·»åŠ  `week_range` å­—æ®µ
- [ ] å·²é‡æ–°å¯¼å…¥ICSæ–‡ä»¶
- [ ] æµ‹è¯•è„šæœ¬å…¨éƒ¨é€šè¿‡
- [ ] è€ƒå‹¤æ—¥å†èƒ½æ­£ç¡®è¿‡æ»¤è¯¾ç¨‹
- [ ] å¯¼å‡ºåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] å­¦æœŸå¼€å§‹æ—¥æœŸé…ç½®æ­£ç¡®

## ğŸ‰ å®Œæˆï¼

ç°åœ¨æ‚¨çš„è€ƒå‹¤ç³»ç»Ÿå·²ç»æ”¯æŒè¯¾ç¨‹å‘¨æ¬¡ç®¡ç†äº†ï¼ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®å½“å‰å‘¨æ¬¡æ˜¾ç¤ºåº”è¯¥ä¸Šè¯¾çš„è¯¾ç¨‹ã€‚

