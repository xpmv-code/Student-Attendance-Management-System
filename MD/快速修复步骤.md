# 快速修复步骤 - 一周多次上课问题

## 🚀 3步快速修复

### 第1步：删除旧课程数据（1分钟）

打开终端，进入项目目录：

```bash
cd /Users/xpmv-mac/PycharmProjects/class
flask shell
```

在Flask shell中执行：

```python
from app.models import Course
from app import db

# 删除所有课程（会级联删除相关考勤记录）
Course.query.delete()
db.session.commit()

print("✅ 旧课程数据已删除")
exit()
```

### 第2步：重新导入ICS文件（2分钟）

1. **启动应用**：
   ```bash
   flask run
   ```

2. **访问课程管理**：
   ```
   http://127.0.0.1:5000/course/
   ```

3. **点击"导入ICS文件"按钮**

4. **选择并上传** `230108.ics` 文件

5. **等待导入完成**，应该看到成功提示

### 第3步：验证修复（1分钟）

#### 验证1：检查课程列表
访问：`http://127.0.0.1:5000/course/`

**预期结果**：
- 如果某门课一周上2次，应该看到2条记录
- 例如：
  ```
  高等数学 - 周一 08:00-09:40
  高等数学 - 周三 10:00-11:40
  ```

#### 验证2：测试考勤记录
访问：`http://127.0.0.1:5000/attendance/`

1. 选择今天或任意有课的日期
2. 点击某节课的"记录考勤"按钮
3. **预期结果**：正常打开考勤记录页面（不再404）

## ✅ 完成！

如果以上步骤都正常，问题已解决：
- ✅ 一周多次上课的课程完整显示
- ✅ 点击"记录考勤"不再404
- ✅ 所有功能正常工作

## ⚠️ 注意事项

1. **删除课程会清空考勤记录**
   - 如果已有重要考勤记录，请先导出备份
   - 建议在学期初或测试阶段进行迁移

2. **Course ID格式变化**
   - 旧格式：`CS101`
   - 新格式：`CS101-1-0800`（课程代码-星期-时间）

3. **课程数量会增加**
   - 一门课一周上N次 = N条课程记录
   - 这是正常且正确的行为

## 🆘 故障排查

### 问题：导入后还是只显示一次课

**检查**：
1. 删除课程是否成功？
   ```python
   from app.models import Course
   print(f"当前课程数：{Course.query.count()}")
   # 应该是0，如果不是0说明没删除成功
   ```

2. 重新导入ICS文件

### 问题：点击记录考勤还是404

**检查**：
1. 查看浏览器地址栏的URL
2. Course ID格式是否正确（应该类似 `CS101-1-0800`）
3. 在Flask shell中验证：
   ```python
   from app.models import Course
   course = Course.query.first()
   print(f"Course ID: {course.course_id}")
   # 应该是新格式，如：CS101-1-0800
   ```

### 问题：某些课程缺失

**可能原因**：ICS文件中的该课程没有"课程代码"信息

**解决**：检查ICS文件内容，确保每个事件都有：
```
课程代码: XXXXXX
```

## 📖 详细文档

- 完整说明：`一周多次上课问题修复.md`
- 类型错误修复：`类型错误修复说明.md`

---

**估计用时**：5分钟  
**难度**：⭐ 简单  
**风险**：⚠️ 会清空考勤记录

